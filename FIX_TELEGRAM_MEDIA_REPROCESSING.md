# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–¥–∏–∞ Telegram –ø–æ—Å—Ç–æ–≤

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ Telegram –ø–æ—Å—Ç–æ–≤ `TelegramPostMediaManager` –≤—ã–∑—ã–≤–∞–ª—Å—è **–¥–≤–∞–∂–¥—ã**:

1. **–ü–µ—Ä–≤—ã–π —Ä–∞–∑** (–ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ –ë–î —á–µ—Ä–µ–∑ `channel_monitor.py`):
   - ‚úÖ –°–∫–∞—á–∏–≤–∞–ª –º–µ–¥–∏–∞ –∏–∑ Telegram —á–µ—Ä–µ–∑ Bot API
   - ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–ª –ª–æ–∫–∞–ª—å–Ω–æ: `D:\work\shorts_news\media\telegram\file_0.jpg`
   - ‚úÖ –û–±–Ω–æ–≤–ª—è–ª `news_data['images']` —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –ø—É—Ç—è–º–∏

2. **–í—Ç–æ—Ä–æ–π —Ä–∞–∑** (–ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ `main_orchestrator.py`):
   - ‚ùå –ù–µ –Ω–∞—Ö–æ–¥–∏–ª –º–µ–¥–∏–∞ (–æ–∂–∏–¥–∞–ª `telegram_photo:...`, –∞ –ø–æ–ª—É—á–∞–ª –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—É—Ç–∏)
   - ‚ùå –í–æ–∑–≤—Ä–∞—â–∞–ª `has_media=False`
   - ‚ùå –ù–æ–≤–æ—Å—Ç—å –±—Ä–∞–∫–æ–≤–∞ –ª–∞—Å—å: "News item has no usable media"

### –õ–æ–≥–∏ –æ—à–∏–±–∫–∏:

```
# –ü–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤ - —É—Å–ø–µ—Ö
2025-10-02 20:08:02,119 - INFO - üì• –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–¥–∏–∞ –∏–∑ Telegram –ø–æ—Å—Ç–∞...
2025-10-02 20:08:04,062 - INFO - ‚úÖ –ú–µ–¥–∏–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 1 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, 0 –≤–∏–¥–µ–æ

# –í—Ç–æ—Ä–æ–π –≤—ã–∑–æ–≤ - –ø—Ä–æ–≤–∞–ª
2025-10-02 20:08:11,644 - INFO - üì• –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–¥–∏–∞ –∏–∑ Telegram –ø–æ—Å—Ç–∞...
2025-10-02 20:08:11,645 - INFO - ‚ÑπÔ∏è –ú–µ–¥–∏–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –ø–æ—Å—Ç–µ
2025-10-02 20:08:11,645 - WARNING - ‚ùå News item 483 has no usable media. Rejecting.
```

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–û–±–Ω–æ–≤–ª–µ–Ω `engines/telegrampost/telegrampost_media_manager.py`:

### –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –º–µ–¥–∏–∞

```python
def process_news_media(self, news_data: Dict[str, Any]) -> Dict[str, Any]:
    # ...
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –ª–∏ —É–∂–µ –º–µ–¥–∏–∞ (–ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—É—Ç–∏ –≤–º–µ—Å—Ç–æ file_id)
    images = news_data.get('images', [])
    videos = news_data.get('videos', [])
    
    # –ï—Å–ª–∏ —ç—Ç–æ –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã (–Ω–µ telegram_ –ø—Ä–µ—Ñ–∏–∫—Å), –∑–Ω–∞—á–∏—Ç —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
    local_images = [img for img in images if img and not img.startswith('telegram_')]
    local_videos = [vid for vid in videos if vid and not vid.startswith('telegram_')]
    
    if local_images or local_videos:
        logger.info("‚úÖ –ú–µ–¥–∏–∞ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã (–Ω–∞–π–¥–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—É—Ç–∏)")
        result['has_media'] = True
        result['downloaded_images'] = local_images
        result['downloaded_videos'] = local_videos
        result['media_paths'] = local_images + local_videos
        
        if local_images:
            result['primary_image'] = local_images[0]
            result['local_image_path'] = local_images[0]
        if local_videos:
            result['video_url'] = local_videos[0]
            result['local_video_path'] = local_videos[0]
        
        logger.info(f"‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –º–µ–¥–∏–∞: {len(local_images)} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, {len(local_videos)} –≤–∏–¥–µ–æ")
        return result
    
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å telegram_ –ø—Ä–µ—Ñ–∏–∫—Å–æ–º (—Å–∫–∞—á–∏–≤–∞–µ–º –∏–∑ Telegram)
    for img_ref in images:
        if img_ref.startswith('telegram_'):
            # ... —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ ...
```

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```
1. channel_monitor –≤—ã–∑—ã–≤–∞–µ—Ç process_news_media()
   images: ['telegram_photo:AgACAgIAAxkBAAI...']
   ‚Üì
   –°–∫–∞—á–∏–≤–∞–µ—Ç ‚Üí D:\work\shorts_news\media\telegram\file_0.jpg
   ‚Üì
   –û–±–Ω–æ–≤–ª—è–µ—Ç news_data['images'] = ['D:\\work\\shorts_news\\media\\telegram\\file_0.jpg']
   ‚Üì
   –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î

2. main_orchestrator –≤—ã–∑—ã–≤–∞–µ—Ç process_news_media()
   images: ['D:\\work\\shorts_news\\media\\telegram\\file_0.jpg']
   ‚Üì
   ‚ùå –ù–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 'telegram_' ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç
   ‚Üì
   ‚ùå –ú–µ–¥–∏–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ ‚Üí has_media=False
   ‚Üì
   ‚ùå –ù–æ–≤–æ—Å—Ç—å –±—Ä–∞–∫—É–µ—Ç—Å—è
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```
1. channel_monitor –≤—ã–∑—ã–≤–∞–µ—Ç process_news_media()
   images: ['telegram_photo:AgACAgIAAxkBAAI...']
   ‚Üì
   –°–∫–∞—á–∏–≤–∞–µ—Ç ‚Üí D:\work\shorts_news\media\telegram\file_0.jpg
   ‚Üì
   –û–±–Ω–æ–≤–ª—è–µ—Ç news_data['images'] = ['D:\\work\\shorts_news\\media\\telegram\\file_0.jpg']
   ‚Üì
   –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î

2. main_orchestrator –≤—ã–∑—ã–≤–∞–µ—Ç process_news_media()
   images: ['D:\\work\\shorts_news\\media\\telegram\\file_0.jpg']
   ‚Üì
   ‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–π –ø—É—Ç—å (–Ω–µ 'telegram_' –ø—Ä–µ—Ñ–∏–∫—Å)
   ‚Üì
   ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç has_media=True —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –ø—É—Ç—è–º–∏
   ‚Üì
   ‚úÖ –í–∏–¥–µ–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
```

## üìã –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

### Telegram file_id (–Ω—É–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å):
```python
'telegram_photo:AgACAgIAAxkBAAI...'
'telegram_video:BAACAgIAAxkBAAI...'
'telegram_animation:BAACAgIAAxkBAAI...'
```

### –õ–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã (—É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã):
```python
'D:\\work\\shorts_news\\media\\telegram\\file_0.jpg'
'resources/media/news/image_123.jpg'
'/absolute/path/to/video.mp4'
```

## üé¨ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å Telegram –ø–æ—Å—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:

```
‚úÖ –ü–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤: –°–∫–∞—á–∏–≤–∞–µ—Ç –º–µ–¥–∏–∞ –∏–∑ Telegram
‚úÖ –í—Ç–æ—Ä–æ–π –≤—ã–∑–æ–≤: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —É–∂–µ —Å–∫–∞—á–∞–Ω–Ω—ã–µ –º–µ–¥–∏–∞
‚úÖ –í–∏–¥–µ–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
```

## üß™ –õ–æ–≥–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

```
# –ü–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤ (channel_monitor)
2025-10-02 20:08:02,119 - INFO - üì• –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–¥–∏–∞ –∏–∑ Telegram –ø–æ—Å—Ç–∞...
2025-10-02 20:08:04,062 - INFO - ‚úÖ –ú–µ–¥–∏–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 1 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, 0 –≤–∏–¥–µ–æ

# –í—Ç–æ—Ä–æ–π –≤—ã–∑–æ–≤ (main_orchestrator)
2025-10-02 20:08:11,644 - INFO - üì• –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–¥–∏–∞ –∏–∑ Telegram –ø–æ—Å—Ç–∞...
2025-10-02 20:08:11,645 - INFO - ‚úÖ –ú–µ–¥–∏–∞ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã (–Ω–∞–π–¥–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—É—Ç–∏)
2025-10-02 20:08:11,645 - INFO - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –º–µ–¥–∏–∞: 1 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, 0 –≤–∏–¥–µ–æ
2025-10-02 20:08:11,645 - INFO - ‚úÖ –í–∏–¥–µ–æ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ
```

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ

–≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –¥–ª—è –¥–≤–∏–∂–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Å–∫–∞—á–∏–≤–∞—é—Ç –º–µ–¥–∏–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—ã–∑–æ–≤–µ –∏ –¥–æ–ª–∂–Ω—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤ —Å —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç:
- `TwitterMediaManager` - —Å–∫–∞—á–∏–≤–∞–µ—Ç Twitter –º–µ–¥–∏–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—ã–∑–æ–≤–µ
- `PoliticoMediaManager` - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç Politico –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –ò –¥—Ä.

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `engines/telegrampost/telegrampost_media_manager.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 2025-10-02  
**–í–µ—Ä—Å–∏—è**: 1.0.2

